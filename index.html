<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Survival</title>
	<link rel="stylesheet" href="game.css" medai="screen">
	<style>

	</style>
	<script src="paper-full.min.js"></script>
	<script src="blockly/blockly_compressed.js"></script>
	<script src="blockly/blocks_compressed.js"></script>
	<script src="blockly/javascript_compressed.js"></script>
	<script src="blockly/ko.js"></script>
	<script src="custom_blocks.js"></script>
	<script type="text/paperscript" src="game2.js" canvas="holder"></script>
	<style media="screen">
		#playground {
			height: 400px;
			width: 400px;
			float: left;
		}

		#holder {
			height: 400px;
			width: 400px;
		}

		#code_editor {
			height: 900px;
			margin-left: 420px;
		}

		#toolbar {}

		#blocklydiv {
			height: 800px;
		}

		.clear {
			clear: both
		}

		#survival_log {
			float: left;
			height: 400px;
			width: 400px;
			margin: 0;
		}


		#img_hero,
		#img_monster,
		#img_trap,
		#img_treasure {
			display: none;
		}
	</style>
</head>


<body>
	<img src="img/hero.png" id="img_hero">
	<img src="img/monster.png" id="img_monster">
	<img src="img/trap.png" id="img_trap">
	<img src="img/treasure.png" id="img_treasure">

	<div id="playground">
		<canvas id="holder"></canvas>
		<textarea id="survival_log"></textarea>
	</div>
	<div id="code_editor">
		<div id="toolbar">
			<input id="game_score" type="text" readonly>
			<button id="run_button">Run the game</button>
			<button id="stop_button">Stop the game</button>
			<label for="random_seed">Stage Number</label><input id="random_seed" type="text" pattern="\d*" value="1">

		</div>
		<div id="blocklydiv"></div>
	</div>
	<div class="clear"></div>

	<xml id="toolbox" style="display:none">
		<block type="controls_if"></block>
		<block type="logic_compare"></block>
		<block type="math_arithmetic"></block>
		<block type="step_number"></block>
		<block type="turn_left"></block>
		<block type="turn_right"></block>
		<block type="detect"></block>
		<block type="blocker_wall"></block>
		<block type="blocker_monster"></block>
		<block type="blocker_trap"></block>
		<block type="blocker_treasure"></block>
		<block type="math_number">
			<field name="NUM">0</field>
		</block>
	</xml>

	<script>
		GameWorkspace = Blockly.inject('blocklydiv',
			{ toolbox: document.getElementById('toolbox') });

		GameWorkspace.addChangeListener(function () {
			var xml = Blockly.Xml.workspaceToDom(GameWorkspace);
			var xml_text = Blockly.Xml.domToText(xml);
			localStorage['blockly_xml'] = xml_text;
		});

		if (localStorage['blockly_xml']) {
			var xml = Blockly.Xml.textToDom(localStorage['blockly_xml']);
			Blockly.Xml.domToWorkspace(xml, GameWorkspace);
		}

		document.getElementById("run_button").addEventListener("click", function (e) {
			var code = Blockly.JavaScript.workspaceToCode(GameWorkspace);
			paper.Game.Start();
		}, false);

		document.getElementById("stop_button").addEventListener("click", function (e) {
			paper.Game.Stop();
		}, false);

		var seed_form = document.getElementById("random_seed");
		window.addEventListener('load', function () {
			if (localStorage['random_seed']) {
				seed_form.value = localStorage['random_seed'];
				paper.Game.SetRandomSeed(parseInt(seed_form.value));
			}
		}, false);

		seed_form.addEventListener("change", function (e) {
			paper.Game.SetRandomSeed(parseInt(seed_form.value));
			localStorage['random_seed'] = seed_form.value;
		}, false);
	</script>
</body>

</html>